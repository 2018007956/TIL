## East/West Traffic (VM↔VM)
- 같은 네트워크/다른 네트워크 모두 포함
- 컴퓨트 노드가 여러 대일 경우, Geneve 터널을 탄다 (하나일 경우 같은 노드 내부에서 처리되므로 Geneve 터널 사용 X)
- 네트워크 노드를 거치지 않는다 (컴퓨트 노드 간에 직접 통신함)
- 예:
	- 같은 네트워크의 VM 간 ping
	- 다른 subnet → OVN Logical Router → 게이트웨이 없이 내부 전달
```
VM1 → tap1 → br-int(compute1) → OVN Logical Switch(L2 switching) → Geneve(remote_ip = compute2) → br-int(compute) → tap2 → VM2
```
### 패킷 흐름 확인
1. VM → tap
	인스턴스 `test01` ID 확인:
	![[Pasted image 20251115153639.png]]
	인스턴스가 올라가있는 Compute 노드에서, VM에 연결된 Tap 인터페이스 정보 확인:
	![[Pasted image 20251115153728.png|500]]
2. tap → br-int
	해당 Tap 인터페이스가 어떤 OVS 브리지에 속하는지 확인:
	![[Pasted image 20251115152504.png]]
3. br-int → OVN Logical Switch
   OVS 포트에 매핑된 Logical Port ID 조회:
	![[Pasted image 20251115155049.png]]
	- 출력값 : Logical Switch Port (LSP = iface-id) 이름
	OVN NB DB에서 Logical Port의 주소 정보 조회:
	![[Pasted image 20251115155612.png]]
	- 인스턴스 `test01`의 주소가 출력되는 것을 볼 수 있음
	- OVN은 Logical Switch Port (LSP)에 VM의 MAC주소와 IP주소를 논리적으로 매핑해두고, 이를 기반으로 논리 스위칭(Logical Switching)을 수행함
	Logical Port가 속한 Logical Switch 이름:
	![[Pasted image 20251115160403.png]]
4. OVN Logical Switch → Geneve Tunnel
	- 컴퓨트 노드가 여러 대이면, `remote_ip`에 다른 컴퓨트 노드들의 IP가 들어감
		![[Pasted image 20251115161637.png]]
		- 참고로, OVN의 Geneve 터널은 Logical Switch에 참여하는 모든 chassis(node) 사이에서 만들어짐
5. Geneve Tunnel → 다른 컴퓨트 노드의 br-int 
	- 네트워크 노드에서 Geneve 터널이 붙은 브리지 확인:	  
		![[Pasted image 20251115163331.png]]
		- br-int에 붙어있는 것을 볼 수 있음
6. Remote br-int → Remote TAP
	- 원격 컴퓨트 노드에서 geneve 포트, VM TAP 포트 확인
	- 해당 network의 Logical Port를 가진 TAP 찾기![[Pasted image 20251115171458.png]]

지금은 컴퓨트 노드가 한 대라서 VM 두 개가 같은 물리 서버 위에서 돌기 때문에,
Compute 노드 내부에서 L2 Switching만 일어나고, Geneve 터널을 사용하지 않음
```
VM1 → tap1 → br-int(compute) → Logical Switch(L2 switching) → br-int(compute) → tap2 → VM2
```


## North/South Traffic (VM↔Public Network)
- VM ↔ 외부(Provider/Public Network) 통신
- Localnet(provenet-UUID) → br-ex → 물리망을 탄다
- Floating IP, SNAT/DNAT, External Gateway 등 사용
```
VM → tap → br-int → Logical Router → Localnet port → br-ex → Provider network → 외부
```
