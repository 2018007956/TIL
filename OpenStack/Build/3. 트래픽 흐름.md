## Compute 노드 네트워크 구조
[외부 네트워크 192.168.50.0/24]
             │
      (GW: 192.168.50.1)
             │
        [물리 NIC enp6s18]
             │ (bridge port)
          ┌───────┐
          │ br-ex │   ← (IP: 192.168.50.122/24, GW: 192.168.50.1, DNS: 1.1.1.1)
          └───────┘
**호스트는 br-ex를 통해 외부 네트워크와 연결되며, enp6s18은 단순히 브리지의 물리적 링크**로만 쓰임
### br-ex 브리지 사용 이유
OpenStack Neutron이나 OVS 기반 네트워크를 구성할 때는 보통 외부 네트워크와 내부(OpenStack tenant 네트워크)를 연결하기 위해 외부 브리지(br-ex)를 둔다
- 물리 NIC(enp6s18)를 바로 쓰면 인스턴스와 외부 네트워크를 NAT/FIP로 연결하기가 어려움
- 물리 NIC를 단순 포트로 두고, `br-ex`가 IP, GW, DNS를 가지면, **호스트 자신 + VM + Floating IP 트래픽**이 모두 같은 브리지를 통해 외부로 나갈 수 있음
즉, OpenStack Neutron이 외부 네트워크를 제어하기 위해 **하나의 공용 출구**를 만들어주는 것
### VM의 네트워크 트래픽 흐름
- **컨트롤러 노드**: Neutron 서버, 데이터베이스, 메시지 큐 등 핵심 네트워크 서비스를 실행합니다. 여기서 **가상 네트워크, 라우터, 보안 그룹** 등이 생성되고 관리된다.
    
- **컴퓨트 노드 (스크린샷)**:
    - `br-int`: Neutron 서비스가 관리하는 가상 네트워크의 VM들이 연결된다.
    - `br-ex`: 컴퓨트 노드의 물리적 네트워크 인터페이스(`enp6s18`)와 연결되어 VM의 트래픽을 **물리적 네트워크**로 전송한다.
        
- **VM (가상 머신)**: `br-int`에 연결되고, Neutron 서비스의 지시에 따라 할당된 IP와 네트워크 설정을 사용한다.

---
[Compute]
1. **VM에서 패킷 생성**: 가상 머신(VM)이 외부로 패킷을 보낼 때, 이 패킷은 VM의 가상 네트워크 인터페이스를 통과합니다.
    
2. **`br-int`로 진입 (L2 브릿징)**: 이 가상 인터페이스는 `br-int` (통합 브리지)에 연결되어 있어 패킷은 이 브리지로 들어옵니다. `br-int`는 OpenStack Neutron이 제어하는 가상 네트워크의 핵심 허브 역할을 합니다.
    
3. **`br-ex`로 이동 (L3 라우팅)**: `br-int`와 `br-ex`는 패치 포트(`patch...`)로 연결되어 있습니다. `br-int`는 VM의 패킷을 이 패치 포트를 통해 **`br-ex` (외부 브리지)**로 보냅니다.
    
4. **물리적 NIC로 전달**: `br-ex`는 컴퓨트 노드의 물리적 네트워크 인터페이스 카드(NIC)인 `enp6s18`에 연결되어 있습니다. `br-ex`는 패킷을 이 물리적 NIC로 전달하고, 패킷은 노드의 물리적 네트워크 케이블을 통해 외부로 전송됩니다.
    ![[Pasted image 20250923215232.png]]

VM이 외부에 있는 컨트롤러 노드나 다른 서비스와 통신할 때, 패킷은 위와 같은 경로를 거쳐 최종 목적지까지 도달하게 된다. 이 과정을 통해 가상 네트워크와 물리적 네트워크가 유기적으로 연결됨.


**VM(TEST01) - VMNET01 - br-ex - NIC**
이렇게 연결되어 있고, 여기서 NIC는 public network랑 동일한 대역대임