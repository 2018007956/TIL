커널 네트워크 스택(Kernel Network Stack)은
리눅스 커널 내부에서 패킷이 NIC ↔ 사용자 프로그램 사이를 이동할 때 거치는  
**IP/TCP/ARP/라우팅/필터링 전 과정을 처리하는 계층 구조**이다
## Stack
여기서 Stack은 **계층 구조**를 뜻한다
리눅스 커널의 네트워킹은 OSI 7계층과 비슷하게 계층적으로 구성되어 있다.

==커널 네트워크 스택 = 커널 내부에서 네트워크 패킷이 통과하는 계층적 경로==

## 전체 구조도
```
┌───────────────────────────┐
│        사용자 공간         │
│  ├── ssh, curl, ping 등   │
│  ├── OpenStack API, nginx │
└────────────┬──────────────┘
             │ (시스템 콜)
             ▼
┌─────────────────────────────────┐
│        커널 공간                 │
│  ┌─ Socket Layer (소켓 계층)     │
│  ├─ TCP / UDP Layer (전송 계층)  │
│  ├─ IP Layer (네트워크 계층)     │
│  ├─ ARP / ICMP / Routing        │
│  ├─ Netfilter / NAT / QoS       │
│  ├─ Device Driver (NIC, OVS 등) │
└────────────┬────────────────────┘  
             ▼
┌──────────────────────────┐
│       네트워크 카드(NIC)  │
│       (eth0, enp6s18 등) │
└──────────────────────────┘
```

## 주요 구성요소
| 계층                       | 역할                 | 예시                               |
| ------------------------ | ------------------ | -------------------------------- |
| **소켓 계층 (Socket Layer)** | 사용자 공간 프로세스와 커널 연결 | `socket()`, `bind()`, `listen()` |
| **전송 계층 (TCP/UDP)**      | 연결 관리, 신뢰성 보장      | `TCP handshake`, `UDP datagram`  |
| **네트워크 계층 (IP)**         | 라우팅, IP 헤더 처리      | `ip route`, `ip rule`            |
| **링크 계층 (L2)**           | MAC 주소, 브리지, VLAN  | `br-ex`, `vlan`, `bond`          |
| **드라이버 계층**              | NIC 제어, DMA 전송     | `enp6s18`, `eth0`                |
| **Netfilter 계층**         | 방화벽/NAT 관리         | `iptables`, `nftables`           |
## 패킷 이동 경로
SSH 요청을 받는 과정을 보면,

1. **NIC(enp6s18)**  
    → 외부에서 들어온 전기 신호(패킷)를 받음
2. **Device Driver**  
    → NIC 드라이버가 패킷을 커널로 전달
3. **커널 네트워크 스택**  
    → IP 레벨에서 목적지를 판단하고, TCP 레벨에서 연결을 식별
4. **소켓 계층(Socket Layer)**  
    → `sshd` 프로세스에 전달
5. **User Space**  
    → `sshd`가 실제로 세션을 처리 (로그인 등)

즉, NIC가 받는 패킷은 항상 커널 네트워크 스택을 통과해야만
유저 프로세스(ssh, ngix, etc)에 도달할 수 있다.